@{
    ViewData["Title"] = "Reporting";
}

@section Styles{

    <style>
        /*https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css
        https://cdn.datatables.net/buttons/1.6.2/css/buttons.dataTables.min.css*/

        .btn-create {
            background-color: #5d5386;
            color: white;
        }

        .btn-apply:hover {
            background-color: white;
            color: black;
        }

        .btn-cancel:hover {
            background-color: red;
            color: white;
        }

        .btn-recover:hover {
            background-color: limegreen;
            color: white;
        }

        .btn-lost:hover {
            background-color: #FFC300;
            color: white;
        }

        select.filter {
            height: 33px !important;
        }

        .dataTable > thead > tr > th[class*="sort"]:before,
        .dataTable > thead > tr > th[class*="sort"]:after {
            content: "" !important;
        }

        .dt-body-right {
            text-align: right;
        }

        .dt-body-center {
            text-align: center;
        }

    
    </style>
}
<div class="content-inner active" id="html-2-pdfwrapper">
    <div class="container-fluid">
        <!-- Begin Page Header-->
        <div class="row">
            <div class="page-header">
                <div class="d-flex align-items-center">
                    <div>
                        <h2 class="page-header-title">Reports</h2>
                    </div>
                </div>
            </div>
        </div>
        <div class="widget has-shadow">
            <h2 style="padding-top:30px;padding-left:30px" class="page-header-title"><b>SUMMARY OF BD ISSUED & BD RECOVERY AS AT </b><b id="CurrMonthYear"></b></h2>
            <h2 style="padding-top:30px;padding-left:30px">Lampiran 1</h2>
            <div class="widget-body">
                <div class="form-group row">
                    <div class="col-xl-2">
                        <select id="ddlMonth" name="ddlMonth" class="selectpicker show-menu-arrow form-control" tabindex="-98" style="background-color:white">
                            <option value="0">Month</option>
                            <option value="1">January</option>
                            <option value="2">February</option>
                            <option value="3">March</option>
                            <option value="4">April</option>
                            <option value="5">May</option>
                            <option value="6">June</option>
                            <option value="7">July</option>
                            <option value="8">August</option>
                            <option value="9">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                    </div>
                    <div class="col-xl-2">
                        <select id="ddlYear" name="ddlYear" class="selectpicker show-menu-arrow form-control" tabindex="-98">
                            <option value="0" selected>Year</option>
                            <option value="2015">2015</option>
                            <option value="2016">2016</option>
                            <option value="2017">2017</option>
                            <option value="2018">2018</option>
                            <option value="2019">2019</option>
                            <option value="2020">2020</option>
                        </select>
                    </div>

                </div>
            </div>
            <div class="row flex-row">
                <div class="col-xl-12">
                    <div class="row flex-row">
                        <div class="col-xl-12 col-md-12">
                            <div class="table-responsive">
                                <div class="widget has-shadow">
                                    <div class="widget-body">
                                        <div class="table-responsive">
                                            <table id="tblLampiran1" class="table table-bordered table-hover mb-0" styles="width:100%">
                                                <thead>
                                                    <tr>
                                                        <th style="text-align:center">State</th>
                                                        <th style="text-align:center">No. of BD Issued</th>
                                                        <th style="text-align:center">Issued Amount (RM)</th>
                                                        <th style="text-align:center">No. of BD Recovered</th>
                                                        <th style="text-align:center">Recovered Amount (RM)</th>
                                                        <th style="text-align:center">Total BD After Recovery</th>
                                                        <th style="text-align:center">Total BD Amount After Recovery(RM)</th>
                                                        @*<th></th>*@
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                                <tfoot>
                                                    <tr style="background-color:#877cb5">
                                                        <td style="font-weight:bold">GRAND TOTAL</td>
                                                        <td id="totalBD" style="text-align:center;font-weight:bold">0</td>
                                                        <td id="totalAmount" style="text-align:right;font-weight:bold">0</td>
                                                        <td id="totalRec" style="text-align:center;font-weight:bold">0</td>
                                                        <td id="totalRecAmount" style="text-align:right;font-weight:bold">0</td>
                                                        <td id="totalBal" style="text-align:center;font-weight:bold">0</td>
                                                        <td id="totalBalAmount" style="text-align:right;font-weight:bold">0</td>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <input type="button" id="create_pdf" value="Generate PDF">
                            @*<button id="btnPull2" class="btn btn-success">Generate</button>*@
                        </div>
                    </div>
                    <!-- End Form -->
                </div>
            </div>
        </div>
    </div>
    <!-- End Container -->
    <!-- Begin Page Footer-->
    <!-- End Page Footer -->
    <a href="#" class="go-top"><i class="la la-arrow-up"></i></a>
    <!-- Offcanvas Sidebar -->
    <!-- End Offcanvas Sidebar -->
</div>

@section Scripts{
    <script src="~/assets/vendors/js/bootstrap-select/bootstrap-select.min.js"></script>
    @*<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
        <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/buttons/1.5.2/js/dataTables.buttons.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
        <script src=https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js></script>
        <script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js"></script>*@

    @*<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>*@
    <script src="~/assets/vendors/js/datatables/datatables.min.js"></script>
    <script src="~/assets/vendors/js/datatables/dataTables.select.min.js"></script>
    <script src="~/assets/vendors/js/datatables/dataTables.buttons.min.js"></script>
    <script src="~/assets/vendors/js/datatables/buttons.flash.js"></script>
    <script src="~/assets/vendors/js/datatables/buttons.print.min.js"></script>
    @*<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js"></script>*@
    <script src="~/assets/vendors/js/datatables/buttons.html5.js"></script>

    <script src="~/assets/vendors/js/tablefilter/jquery.tablefilter.js"></script>
    <script src="~/assets/vendors/js/tablefilter/jquery.tabledatafilter.min.js"></script>
    <script src="~/assets/vendors/js/datatables/sum.js"></script>
    <script src="~/assets/vendors/js/tablefilter/jquery.tableditfixedheader.min.js"></script>
    <script>
        var months = ["", "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        var d = new Date();
        var currMonth = d.getMonth() + 1;
        var currYear = d.getFullYear();
        var monthName = months[currMonth];
        var month = $("#ddlMonth").val(currMonth);
        var year = $("#ddlYear").val(currYear);

        //var element = document.getElementById("create_pdf");
        //element.addEventListener("click", onClick);

        //function onClick() {
            
        //};


        $(document).ready(function () {

            $('#CurrMonthYear').text(monthName + " " + currYear);

            $(function () {
                $("nav").addClass("shrinked");
            });
            console.log("s" + currMonth + "s" + currYear);

            var table = $('#tblLampiran1').DataTable({
                dom: "Bfrtip",
                buttons: ['copyHtml5', 'excelHtml5', 'csvHtml5', 'pdfHtml5'],
                "processing": true,
                "columnDefs": [
                    { className: "dt-body-center", "targets": [1, 3, 5] },
                    { className: "dt-body-right", "targets": [2, 4, 6] }
                ],
                drawCallback: function () {
                    var api = this.api();
                    var col1 = api.column(1, { page: 'current' }).data().sum();
                    var col2 = parseFloat(api.column(2, { page: 'current' }).data().sum()).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
                    var col3 = api.column(3, { page: 'current' }).data().sum();
                    var col4 = parseFloat(api.column(4, { page: 'current' }).data().sum()).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
                    var col5 = api.column(5, { page: 'current' }).data().sum();
                    var col6 = parseFloat(api.column(6, { page: 'current' }).data().sum()).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
                    $("#totalBD").text(col1);
                    $("#totalAmount").text("(" + col2 + ")");
                    $("#totalRec").text(col3);
                    $("#totalRecAmount").text("(" + col4 + ")");
                    $("#totalBal").text(col5);
                    $("#totalBalAmount").text("(" + col6 + ")");
                },
                //serverSide: true,
                //columnDefs: [
                //    {
                //        targets: -1,
                //        className: 'dt-body-left'
                //    }
                //],
                "ajax": {
                    url: "/Reporting/GetReportForState?month=" + currMonth + "&year=" + currYear + "",
                    type: "GET",
                    data: function (d) {

                    },
                    dataFilter: function (result) {
                        var jData = JSON.parse(result);
                        var dtData = JSON.stringify({ "data": jData });
                        return dtData;
                    }
                },

                order: [[1, 'asc']],
                columns: [
                    { data: "state" },
                    { data: "noOfBDIssued" },
                    { data: "amount" },
                    { data: "noOfRecovery" },
                    { data: "amountRev" },
                    { data: "noOfOutstanding" },
                    { data: "outstandingAmount" },
                ],
                "bPaginate": false,
                "bLengthChange": false,
                "bFilter": false,
                "bInfo": false,
                "bAutoWidth": false,
                orderCellsTop: true,
                fixedHeader: true,
                "lengthChange": false,
            });


            $("#ddlMonth").change(function () {
                var end = this.value;
                month = $('#ddlMonth').val();
                year = $('#ddlYear').val();
                if (month != null && year != null) {
                    table.ajax.url("/Reporting/GetReportForState?month=" + month + "&year=" + year + "").load();
                    $('#CurrMonthYear').text(months[month] + " " + year);
                }
                console.log("month:" + month + " year:" + year);
            });

            $("#ddlYear").change(function () {
                var end = this.value;
                month = $('#ddlMonth').val();
                year = $('#ddlYear').val();
                if (month != null && year != null) {
                    table.ajax.url("/Reporting/GetReportForState?month=" + month + "&year=" + year + "").load();
                    $('#CurrMonthYear').text(months[month] + " " + year);
                }
                console.log("month:" + month + " year:" + year);

            });

            $('.table thead filterCol').appendTo('table thead');

            $.each($('.input-filter', table.table().header()), function () {
                var column = table.column($(this).index());

                $('input', this).on('keyup change', function () {
                    table.ajax.reload();
                });
            });

            $.each($('.select-filter', table.table().header()), function () {
                var column = table.column($(this).index());

                $('select', this).on('change', function () {
                    table.ajax.reload();
                });
            });



        });

        //$("#btnPull2").on('click', function () {

        //    $.ajax({
        //        type: "GET",
        //        url: "/Reporting/GenerateApplication",
        //        processData: false,
        //        contentType: false,
        //        success: function (data) {
        //            $("#tblLampiran1 tbody tr").remove();
        //            for (var i = 0; i < data.length; i++) {
        //                console.log(data[i]);

        //                $('#tblLampiran1').append('<tr><td>' + data[i].state + '</td><td style="text-align:center">' + data[i].noOfBDIssued + '</td><td style="text-align:right">' + data[i].amount + '</td><td style="text-align:center">' + data[i].noOfRecovery + '</td><td style="text-align:right">' + data[i].amountRev + '</td><td style="text-align:center">' + data[i].noOfOutstanding + '</td><td style="text-align:right">' + data[i].outstandingAmount + '</td></tr>');


        //            }
        //        }
        //    });

        //});
    </script>
}